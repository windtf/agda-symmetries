% !TEX root = types25pp-sort.tex

\section{Introduction}
\label{sec:introduction}

Consider a puzzle about sorting,
inspired by Dijkstra's Dutch National Flag problem~\cite[Ch.14]{dijkstraDisciplineProgramming1997}.
Suppose there are balls of three colors,
corresponding to the colors of the Dutch flag: red, white, and blue.
\[
  \{
  \tikz[anchor=base, baseline]{%
    \foreach \x/\color in {1/red,2/white,3/blue} {
        \node[circle,draw,fill=\color,line width=1pt] at (\x,0) {\phantom{\tiny\x}};
        \ifthenelse{\NOT 1 = \x}{\node at ({\x-0.5},0) {,};}{}
      }
  }
  \}
\]
Given an unordered list (bag) of such balls, how many ways can you sort them into the Dutch flag?
\[
  \bag{
    \tikz[anchor=base, baseline]{%
      \foreach \x/\color in {1/red,2/red,3/blue,4/white,5/blue,6/red,7/white,8/blue} {
          \node[circle,draw,fill=\color,line width=1pt] at (\x,0) {\phantom{\tiny\x}};
          \ifthenelse{\NOT 1 = \x}{\node at ({\x-0.5},0) {,};}{}
        }
    }
  }
\]
Obviously there is only one way, decided by the order the colors appear in the Dutch flag:
$\term{red} < \term{white} < \term{blue}$.
\[
  [
      \tikz[anchor=base, baseline]{%
        \foreach \x/\color in {1/red,2/red,3/red,4/white,5/white,6/blue,7/blue,8/blue} {
            \node[circle,draw,fill=\color,line width=1pt] at (\x,0) {\phantom{\tiny\x}};
            \ifthenelse{\NOT 1 = \x}{\node at ({\x-0.5},0) {,};}{}
          }
      }
    ]
\]
What if we are avid enjoyers of vexillology who also want to consider other flags?
We might ask: how many ways can we sort our unordered list of balls?
We know there are exactly $3! = 6$ permutations of
$\{\term{red}, \term{white}, \term{blue}\}$, so there are 6 possible orderings we can define.
In fact, there are exactly 6 such categories of tricolor flags
(see~\href{https://en.wikipedia.org/wiki/List_of_flags_with_blue,_red,_and_white_stripes#Triband}{Wikipedia}).
We have no allegiance to any of the countries presented by the flags, hypothetical or otherwise --
this is purely a matter of combinatorics.
\begin{center}
  \foreach \colorA/\colorB/\colorC in {red/white/blue, red/blue/white, white/red/blue, white/blue/red, blue/red/white, blue/white/red}{
      \begin{tikzpicture}[scale=0.5]
        \begin{flagdescription}{3/4}
          \hstripesIII{\colorA}{\colorB}{\colorC}
          \framecode{}
        \end{flagdescription}
      \end{tikzpicture}
    }
\end{center}
We posit that, because there are exactly 6 orderings, we can only define 6 \emph{extensionally correct} sorting functions.
%
Formally, there is a bijection between the set of orderings on a carrier set $A$ and the set of correct sorting
functions on lists of $A$.
%
A sorting function can be correctly axiomatised from this point of view, which is our main contribution.

\paragraph*{Outline and Contributions}

The paper is organised as follows:
\begin{myitemize}
  \item In~\cref{sec:universal-algebra}, we describe a formalisation of universal algebra developed from the point of view
        of functorial signatures, the definition and universal property of free algebras,
        and equational systems over signatures.
        %
        These are elementary constructions but necessary groundwork for us,
        and we give an informal exposition in type theory.
  \item In~\cref{sec:monoids}, we give constructions of free monoids, and proofs of their universal property.
        Following this, in~\cref{sec:commutative-monoids}, we add commutativity to each representation of free monoids,
        and extend the proofs of universal property from free monoids to free commutative monoids.
        These constructions are standard, and we formalise by using our general framework.
  \item In \cref{sec:application}, we build on the previous constructions and study sorting functions.
        The main result connects total orders, sorting, and commutativity,
        by proving an equivalence between decidable total orders on a carrier set $A$,
        and correct sorting functions defined using free monoids and free commutative monoids over $A$.
  \item Finally, \cref{sec:discussion} discusses aspects of the formalisation, related and future work.
\end{myitemize}
%
The three main parts of the paper may be read independently.
%
Readers interested in the formalisation of universal algebra and free algebras
may start from~\cref{sec:universal-algebra}.
%
Readers interested in concrete constructions of free monoids and free commutative monoids
may skip ahead to~\cref{sec:monoids,sec:commutative-monoids}.
%
If the reader is already familiar with these constructions,
they may directly skip to the technical section on sorting functions, in~\cref{sec:application}.
%
The paper is accompanied by a formalisation of all the results in Cubical Agda,
and the artifact is available online at~\cite{choudhuryAgdasymmetries2025}.
However, we use informal mathematical language in the paper to keep the presentation accessible.
%
\ifarxiv{}{An extended version of the paper including additional details and proofs is available on Zenodo~\cite{extendedVersion}.}