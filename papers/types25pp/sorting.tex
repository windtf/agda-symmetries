% !TEX root = types25pp-sort.tex

\subsection{Total orders}
\label{sec:total-orders}

First, we recall the axioms of a total order or linear order $\leq$ on a set $A$.
\begin{definition}[\alink{definition}{Total order}]
    \label{def:total-order}
    A total order on a set $A$ is a relation $\leq : A \to A \to \hProp$ that satisfies:
    \begin{itemize}
        \item reflexivity: $x \leq x$,
        \item transitivity: if $x \leq y$ and $y \leq z$, then $x \leq z$,
        \item antisymmetry: if $x \leq y$ and $y \leq x$, then $x = y$,
        \item totality: $\forall x, y$, either $x \leq y$ or $y \leq x$.
    \end{itemize}
    A \emph{decidable} total order requires the $\leq$ relation to be decidable:
    \begin{itemize}
        \item decidable totality: $\forall x, y$, we have $x \leq y + \neg(x \leq y)$.
    \end{itemize}
\end{definition}
Note that \emph{either-or} means a (truncated) logical disjunction.
In the context of this paper, we want to make a distinction between
``decidable total order'' and ``total order''.
The decidability axiom strengthens the totality axiom,
where we have either $x \leq y$ or $y \leq x$ merely as a proposition,
but decidability allows us to produce a witness if $x \leq y$ is true.
\begin{proposition}[\alink{proposition}{}]
    \label{prop:decidable-total-order}
    In a decidable total order, it holds that ${\forall x, y}, \ps{x \leq y} + \ps{y \leq x}$.
    Further, this makes $A$ discrete, that is ${\forall x, y}, \ps{x \id y} + \ps{x \neq y}$.
\end{proposition}
\begin{proof}
    We decide if $x \leq y$ and $y \leq x$, and by cases:
    \begin{itemize}
        \item
              if $x \leq y$ and $y \leq x$: by antisymmetry, $x = y$.
        \item
              if $\neg(x \leq y)$ and $y \leq x$: assuming $x = y$ leads to a contradiction, hence $x \neq y$.
        \item
              if $x \leq y$ and $\neg(y \leq x)$: similar to the previous case.
        \item
              if $\neg(x \leq y)$ and $\neg(y \leq x)$: by totality, either
              $x \leq y$ or $y \leq x$, which leads to a contradiction.
    \end{itemize}
\end{proof}
We also recall the axioms of a strict total order $<$ on $A$.
\begin{definition}[\alink{definition}{Strict total order}]
    \label{def:strict-total-order}
    A strict total order on a set $A$ is a relation $< : A \to A \to \hProp$ that satisfies:
    \begin{itemize}
        \item irreflexivity: $\neg(x < x)$,
        \item transitivity: if $x < y$ and $y < z$, then $x < z$,
        \item asymmetry: if $x < y$, then $\neg(y < x)$,
        \item cotransitivity: $\forall x, y, z$, if $x < z$, then either $x < y$ or $y < z$.
        \item connectedness: $\forall x, y$, if $\neg(x < y)$ and $\neg(y < x)$, then $x = y$.
    \end{itemize}
    A \emph{decidable} strict total order requires the $<$ relation to be decidable:
    \begin{itemize}
        \item decidability: $\forall x, y$, we have $x < y + \neg(x < y)$.
    \end{itemize}
\end{definition}

\begin{proposition}[\alink{proposition}{}]
    \label{prop:decidable-strict-total-order}
    In a decidable strict total order, it holds that ${\forall x, y}, \ps{x < y} + \ps{y < x}$.
    Further, this makes $A$ discrete, that is ${\forall x, y}, \ps{x \id y} + \ps{x \neq y}$.
\end{proposition}
\begin{proof}
    We decide if $x < y$ and $y < x$, and by cases:
    \begin{itemize}
        \item if $\neg(x < y)$ and $\neg(y < x)$: by connectedness, $x = y$.
        \item if $x < y$ or $y < x$: by irreflexivity, $x \neq y$.
    \end{itemize}
\end{proof}

\begin{proposition}[\alink{proposition}{}]
    \label{prop:decidable-strict-total-order}
    The set of decidable strict total orders on $A$ and the set of decidable total orders on $A$ are equivalent.
\end{proposition}
\begin{proofsketch}
    Given a decidable total order $\leq$ on $A$, by~\cref{prop:decidable-total-order},
    we map it to a decidable strict total order $<$ on $A$ by
    $x < y \defeq (x \leq y) \times (x \neq y)$. Vice versa, by~\cref{prop:decidable-strict-total-order}
    given a decidable strict total order $<$ on $A$,
    we map it to a decidable total order $\leq$ on $A$ by
    $x \leq y \defeq (x < y) + (x = y)$.
    These maps are inverses of each other.
\end{proofsketch}

%
\noindent
An equivalent way of defining a total order is using a binary meet operation, without starting from an ordering relation.
\begin{definition}[\alink{definition}{Meet semi-lattice}]
    \label{def:meet-semi-lattice}
    A meet semi-lattice is a set $A$ with a binary operation $\blank\meet\blank : A \to A \to A$ that is:
    \begin{itemize}
        \item idempotent: $x \meet x \id x$,
        \item associative: $(x \meet y) \meet z \id x \meet (y \meet z)$,
        \item commutative: $x \meet y \id y \meet x$.
    \end{itemize}
    A \emph{strongly-connected} meet semi-lattice further satisfies:
    \begin{itemize}
        \item strong-connectedness: $\forall x, y$, either $x \meet y \id x$ or $x \meet y \id y$.
    \end{itemize}
    A \emph{decidable} strongly-connected meet semi-lattice strengthens this to:
    \begin{itemize}
        \item decidable strong-connectedness: ${\forall x, y}, \ps{x \meet y \id x} + \ps{x \meet y \id y}$.
    \end{itemize}
\end{definition}

\begin{proposition}[\alink{proposition}{}]
    \label{prop:total-order-meet-semi-lattice}
    A total order $\leq$ on a set $A$ is equivalent to a strongly-connected meet semi-lattice structure on $A$.
    Further, a decidable total order on $A$ induces a decidable strongly-connected meet semi-lattice structure on $A$.
    \vc{equivalence?}
\end{proposition}
\begin{proofsketch}
    Given a (mere) total order $\leq$ on a set $A$,
    we define ${x \meet y} \defeq \term{if} x \leq y \term{then} x \term{else} y$.
    %
    Crucially, this map is \emph{locally-constant}, allowing us to eliminate from an $\hProp$ to an $\hSet$.
    %
    Meets satisfy the universal property of products, that is,
    ${c \leq a \meet b} \Leftrightarrow {c \leq a} \land {c \leq b}$,
    and the axioms follow by calculation using $\yo$-arguments.
    %
    Conversely, given a meet semi-lattice, we define $x \leq y \defeq x \meet y \id x$,
    which defines an $\hProp$-valued total ordering relation.
    %
    If the total order is decidable, we use the discreteness of $A$ from~\cref{prop:decidable-total-order}.
\end{proofsketch}
%
Finally, tying this back to~\cref{def:head-free-monoid}, we have the following for free commutative monoids.
\begin{definition}[\alink{definition}{$\term{head}$}]
    \label{def:head-free-commutative-monoid}
    Assume a total order $\leq$ on a set $A$.
    We define a commutative monoid structure on $1 + A$,
    with unit \(e \defeq \inl(\ttt) : 1 + A\), and multiplication defined as:
    \[
        \begin{array}{rclcl}
            \inl(\ttt) & \oplus & b          & \defeq & b                         \\
            \inr(a)    & \oplus & \inl(\ttt) & \defeq & \inr(a)                   \\
            \inr(a)    & \oplus & \inr(b)    & \defeq & \inr(a \meet b) \enspace.
        \end{array}
    \]
    This gives a homomorphism \({\term{head} \defeq \ext{\inr}} : {\MM(A) \to 1 + A}\),
    which picks out the \emph{least} element of the free commutative monoid.
\end{definition}

\subsection{Sorting functions}
\label{sec:sorting}

The free commutative monoid is also a monoid, hence, there is a canonical monoid homomorphism
$q : \LL(A) \to \MM(A)$, which is given by $\ext{\eta_A}$, the extension of the unit $\eta_A : A \to \MM(A)$.
%
Since $\MM(A)$ is (upto equivalence), a quotient of $\LL(A)$ by symmetries (or a permutation relation),
it is a surjection (in particular, a regular epimorphism in $\Set$ as constructed in type theory).
%
Concretely, $\quotient$ simply includes the elements of $\LL(A)$ into equivalence classes of lists in $\MM(A)$,
which ``forgets'' the order that was imposed by the indexing of the list.

Classically, assuming the Axiom of Choice would allow us to construct a section (right-inverse, in $\Set$) to the surjection $\quotient$,
that is,
a function $s : \MM(A) \to \LL(A)$ such that $\forall x.\, q(s(x)) \id x$.
%
Or in informal terms, given the surjective inclusion into the quotient,
a section (uniformly) picks out a canonical representative for each equivalence class.
%
The core question we want to study is the existence of $\ssection$ in a constructive
setting, or equivalently, whether the order factored out by the symmetry quotient
can be constructively recovered.
\begin{figure}
    \centering
    \scalebox{1.0}{
        % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXExMKEEpIl0sWzMsMCwiXFxNTShBKSJdLFsxLDAsInMiLDAseyJjdXJ2ZSI6LTF9XSxbMCwxLCJxIiwwLHsiY3VydmUiOi0xfV1d
        \begin{tikzcd}[ampersand replacement=\&,cramped]
            {\LL(A)} \&\&\& {\MM(A)}
            \arrow["\ssection", curve={height=-10pt}, from=1-4, to=1-1]
            \arrow["\quotient", two heads, from=1-1, to=1-4]
        \end{tikzcd}
    }
    \caption{Relationship of $\LL(A)$ and $\MM(A)$}
    \label{fig:enter-label}
\end{figure}
%
Viewing the quotienting relation as a permutation relation (from~\cref{sec:cmon:qfreemon}), a section $\ssection$ to $\quotient$ has to pick out
canonical representatives of equivalence classes generated by permutations.
%
Using $\SList$ as an example,
$s(x \cons y \cons \xs) \id s(y \cons x \cons \xs)$ for any $x, y : A$ and $\xs : \SList(A)$,
by $\term{swap}$.
%
Since $\forall \xs.\,q(s(\xs)) \id \xs$, $\ssection$ must preserve all the elements of $\xs$.
It cannot be a trivial function such as $\lambda\,\xs. []$ -- it must produce a permutation of the elements of $\ssection$.
%
But to place these elements side-by-side in the list, $\ssection$ must somehow impose an order on $A$
(invariant under permutation), turning unordered lists of $A$ into ordered lists of $A$.
%
Axiom of Choice (AC) giving us a section $\ssection$ to $\quotient$ ``for free'' is analagous to how
AC implies the well-ordering principle, which states every set can be well-ordered.
%
Thus, if AC was assumed, we could easily recover an order on $A$ from the section $\ssection$.
%
Instead we study how to constructively define such a section, and in fact,
that is exactly the extensional view of a sorting algorithm,
and the implications of its existence is that $A$ can be ordered, or sorted.

\subsubsection{Section from Order}
\label{sec:sort-section-from-order}

\begin{proposition}[\alink{proposition}{}]
    Assume a decidable total order on $A$. There is a sort function $\ssection: \MM(A) \to \LL(A)$
    which constructs a section to $\quotient : \LL(A) \twoheadrightarrow \MM(A)$
\end{proposition}

\begin{proofsketch}
    We may construct such a sort function by implementing any sorting algorithm.
    In our formaliziation we chose insertion sort,
    because it can be defined easily using the inductive structure of $\SList(A)$ and $\List(A)$.
    To implement other sorting algorithms like mergesort,
    other representations such as $\Bag$ and $\Array$ would be preferable,
    as explained in~\cref{sec:cmon:bag}.
    To see how this proposition holds: $q(s(\xs))$ first orders an unordered list $\xs$ by $\ssection$,
    then discards the order again by $\quotient$ --
    imposing and then forgetting an order on $\xs$ simply \emph{permutes} its elements,
    which proves $\quotient \comp \ssection = \idfunc$.
\end{proofsketch}

\subsubsection{Order from Section}
\label{sec:sort-order-from-section}

The previous section allowed us to construct a section, but an arbitrary section may not be a sorting function.
%
To show a section is indeed a sort function, we need to show the section imposes some total order on $A$ which it sorts by.
%
Indeed, just by the virtue of $\ssection$ being a section,
we can \emph{almost} construct a total-order on the carrier set.

\begin{definition}[\alink{definition}{$\term{least}$}]
    \label{def:least}
    Given a section $\ssection$, we define:
    \[
        x \leqs y \defeq \term{head}(s(\bag{x, y})) = \inr(x) \enspace.
    \]
\end{definition}
%
That is, we take the two-element bag $\bag{x, y}$,
``sort'' it by $\ssection$, and test if the $\term{head}$ element is $x$.
%
Note, this is equivalent to $x \leqs y \defeq s\bag{x, y} = [x,y]$,
because $\ssection$ preserves length, and the second element is forced to be $y$.
%
% \begin{proposition}
%     $\leqs$ is decidable iff $A$ has decidable equality.
% \end{proposition}

\begin{proposition}[\alink{proposition}{}]
    \label{sort:almost-total}
    $\leqs$ is reflexive, antisymmetric, and total.
\end{proposition}
\begin{proof}
    For all $x$, $\term{least}(\bag{x, x})$ must be $\inr(x)$, therefore $x \leqs x$, giving reflexivity.
    For all $x$ and $y$, given $x \leqs y$ and $y \leqs x$,
    we have $\term{least}(\bag{x, y}) = \inr(x)$ and $\term{least}(\bag{y, x}) = \inr(y)$.
    Since $\bag{x, y} = \bag{y, x}$, $\term{least}(\bag{x, y}) = \term{least}(\bag{y, x})$,
    therefore we have $x = y$, giving antisymmetry.
    For all $x$ and $y$, $\term{least}(\bag{x, y})$ is merely either $\inr(x)$ or $\inr(y)$,
    therefore we have merely either $x \leqs y$ or $y \leqs x$, giving totality.
\end{proof}
%
A crucial observation is that $\ssection$ correctly orders 2-element bags,
but it does not necessarily sort bags with 3 or more elements.
\begin{proposition}
    \label{prop:counterexample-transitivity}
    $\leqs$ is not necessarily transitive.
\end{proposition}
\begin{proof}
    We give a counterexample of an $\ssection$ that violates transitivity.
    Consider the section $s : \SList(\Nat) \to \List(\Nat)$ defined as follows.
    First, we define a sort function
    $\term{sort} : \SList(\Nat) \to \List(\Nat)$ which sorts $\SList(\Nat)$ ascendingly.
    Then we use $\term{sort}$ to construct $\ssection$.
    \begin{align*}
        \ssection(\xs) & = \begin{cases}
                       \term{sort}(\xs)                 & \text{if $\term{length}(\xs)$ is odd} \\
                       \term{reverse}(\term{sort}(\xs)) & \text{otherwise}
                   \end{cases}
    \end{align*}
    %
    Now we have $\ssection([2,3,1]) = [1,2,3]$ but $\ssection([2,3,1,4]) = [4,3,2,1]$.
\end{proof}
%
We will enforce additional constraints on the \emph{image} of $\ssection$, to turn it into a correct sort function.
\begin{definition}[\alink{definition}{$\blank\in\im{\ssection}$}]
    \label{def:in-image}
    The fiber of $\ssection$ at a point in the codomain~$\xs : \LL(A)$
    is given by $\fib_{\ssection}(\xs) \defeq \dsum{ys : \MM(A)}{(\ssection(ys) = \xs)}$.
    %
    The image of $\ssection$ is given by $\im{\ssection} \defeq \dsum{\xs : \LL(A)}{\Trunc[-1]{\fib_{\ssection}(\xs)}}$.
    %
    Simplifying, we say that $\xs:\LL(A)$ is ``in the image of $\ssection$'', or, $\xs \in \im{\ssection}$,
    if there merely exists a $\ys:\MM(A)$ such that $\ssection(\ys) = \xs$.
\end{definition}
%
If $\ssection$ \emph{were} a sort function, the image of $\ssection$ would be the set of $\ssection$-``sorted'' lists,
therefore $\inimage{\xs}$ would imply $\xs$ is a correctly $\ssection$-``sorted'' list.
%
First, we note that the 2-element case is correct.
%
\begin{proposition}[\alink{proposition}{}]
    \label{sort:sort-to-order}
    $x \leqs y$ \; iff \; $\inimage{[x, y]}$.
\end{proposition}
%
\noindent Then, we state the first axiom on $\ssection$.
\begin{definition}[\alink{definition}{$\isheadleast$}]
    \label{sort:head-least}
    A section $\ssection$ satisfies $\isheadleast$ iff for all $x, y, \xs$:
    \[
        y \in x \cons \xs \; \land \; \inimage{x \cons \xs} \; \to \; \inimage{[x, y]}
        \enspace.
    \]
\end{definition}
\noindent
We use the definition of list membership from~\cref{def:membership}.
The $\in$ symbol is intentionally overloaded
to make the axiom look like a logical ``cut'' rule.
Informally, it says that the head of an $\ssection$-``sorted'' list
is the least element of the list.

\begin{proposition}[\alink{proposition}{}]
    \label{prop:order-to-sort-head-least}
    If $A$ has a total order $\leq$,
    insertion sort defined using $\leq$ satisfies $\isheadleast$.
\end{proposition}

\begin{proposition}[\alink{proposition}{}]
    \label{sort:trans}
    If $\ssection$ satisfies $\isheadleast$, $\leqs$ is transitive.
\end{proposition}
\begin{proof}
    Given $x \leqs y$ and $y \leqs z$, we want to show $x \leqs z$.
    Consider the 3-element bag $\bag{x,y,z} : \MM(A)$.
    %
    Let $u$ be $\term{least}(\bag{x,y,z})$,
    by~\cref{sort:head-least} and~\cref{sort:sort-to-order},
    we have $u \leqs x \land u \leqs y \land u \leqs z$.
    %
    Since $u \in \bag{x,y,z}$, $u$ must be one of the elements.
    %
    If $u = x$ we have $x \leqs z$.
    If $u = y$ we have $y \leqs x$,
    and since $x \leqs y$ and $y \leqs z$ by assumption,
    we have $x = y$ by antisymmetry, and then we have $x \leqs z$ by substitution.
    Finally, if $u = z$, we have $z \leqs y$, and since $y \leqs z$ and $x \leqs y$ by assumption,
    we have $z = y$ by antisymmetry, and then we have $x \leqs z$ by substitution.
\end{proof}

\subsubsection{Embedding orders into sections}
\label{sec:sort-embedding}

Following from \cref{sort:almost-total,sort:trans},
and \cref{prop:order-to-sort-head-least},
we have shown that a section $\ssection$ that satisfies $\isheadleast$ produces a total order
$x \leqs y \defeq \term{least}(\bag{x, y}) \id \inr(x)$,
and a total order $\leq$ on the carrier set produces a section satisfying $\isheadleast$,
constructed by sorting with $\leq$.
%
This constitutes an embedding of decidable total orders into sections satisfying $\isheadleast$.

\begin{proposition}[\alink{proposition}{}]
    \label{sort:o2s2o}
    Assume $A$ has a decidable total order $\leq$, we can construct a section $\ssection$ that
    satisfies $\isheadleast$, such that $\leqs$ constructed from $\ssection$ is equivalent
    to $\leq$.
\end{proposition}
\begin{proof}
    By the insertion sort algorithm parameterized by $\leq$,
    it holds that $\inimage{[x, y]}$ iff $x \leq y$.
    By~\cref{sort:sort-to-order}, we have $x \leqs y$ iff $x \leq y$.
    We now have a total order $x \leqs y$ equivalent to $x \leq y$.
\end{proof}

\subsubsection{Equivalence of order and sections}

We want to upgrade the embedding to an isomorphism, and it
remains to show that we can turn a section satisfying $\isheadleast$ to a total order $\leqs$,
then construct the \emph{same} section back from $\leqs$.
Unfortunately, $\isheadleast$ is not enough to guarantee this.
\begin{proposition}
    \label{prop:counterexample-equivalence}
    Assume $A$ is a set with different elements, i.e. $\exists x, y: A.\,x \neq y$,
    we cannot construct a full equivalence between sections that satisfy $\isheadleast$
    and total orders on $A$.
\end{proposition}
\begin{proof}
    We give a counter-example of $\ssection$ that satisfy $\isheadleast$ but is not a sort function.
    Consider the insertion sort function $\term{sort} : \MM(\Nat) \to \LL(\Nat)$
    parameterized by $\leq$:
    \begin{align*}
        \term{reverseTail}([])          & = []                                   \\
        \term{reverseTail}(x \cons \xs) & = x \cons \term{reverse}(\xs)          \\
        s(\xs)                          & = \term{reverseTail}(\term{sort}(\xs)) \\
        s(\bag{2,3,1,4})                & = [1,4,3,2]                            \\
        s(\bag{2,3,1})                  & = [1, 3, 2]                            \\
        s(\bag{2,3})                    & = [2, 3]                               \\
    \end{align*}
    By~\cref{sort:o2s2o} we can use $\term{sort}$ to construct $\leqs$ which would be
    equivalent to $\leq$. However, the $\leqs$ constructed by $\ssection$ would also be equivalent
    to $\leq$. This is because $\ssection$ sorts 2-element list correctly, despite $s \neq \term{sort}$.
    Since two different sections satisfying $\isheadleast$ maps to the same total order,
    there cannot be a full equivalence.
\end{proof}

Therefore, we need to introduce a second axiom of sorting.

\begin{definition}[\alink{definition}{$\istailsort$}]
    \label{def:tail-sort}
    A section $\ssection$ satisfies $\istailsort$ iff
    for all $x, \xs$,
    \[
        \inimage{x \cons \xs} \to \inimage{\xs}
    \]
\end{definition}

This says that $\ssection$-``sorted'' lists are downwards-closed under cons-ing, that is,
the tail of an $\ssection$-``sorted'' list is also $\ssection$-``sorted''.
%
To prove the correctness of our axioms,
first we need to show that a section $\ssection$ satisfying
$\isheadleast$ and $\istailsort$ is equal to insertion sort parameterized by
the $\leqs$ constructed from $\ssection$.
%
In fact, the axioms we have introduced are equivalent to the standard inductive characterization of sorted lists,
found in textbooks, such as in~\cite{appelVerifiedFunctionalAlgorithms2023}.

\begin{code}
data IsSorted ($\leq$ : A -> A -> UU) : List A -> UU where
  sorted-nil : IsSorted []
  sorted-$\eta$ : forall x -> IsSorted [ x ]
  sorted-cons : forall x y zs -> x $\leq$ y
     -> IsSorted (y cons zs) -> IsSorted (x cons y cons zs)
\end{code}
Note that $\term{IsSorted}_{\leq}(\xs)$ is a proposition for every $\xs$,
and forces the list $\xs$ to be permuted in a unique way.
\begin{lemma}[\alink{lemma}{}]
    Given a total order $\leq$, for any $\xs, \ys : \LL(A)$,
    $q(\xs) = q(\ys) \land \term{IsSorted}_{\leq}(\xs) \land \term{IsSorted}_{\leq}(\ys) \to \xs = \ys$.
\end{lemma}

Insertion sort by $\leq$ always produces lists that satisfy $\term{IsSorted}_{\leq}$.
Functions that also produce lists satisfying $\term{IsSorted}_{\leq}$ are equal to insertion sort
by function extensionality.

\begin{proposition}[\alink{proposition}{}]
    \label{sort:sort-uniq}
    Given a total order $\leq$,
    if a section $\ssection$ always produces sorted list, i.e. $\forall \xs.\,\term{IsSorted}_{\leq}(s(\xs))$,
    $\ssection$ is equal to insertion sort by $\leq$.
\end{proposition}
\noindent
Finally, this gives us correctness of our axioms.

\begin{proposition}[\alink{proposition}{}]
    \label{sort:well-behave-sorts}
    Given a section $\ssection$ that satisfies $\isheadleast$ and $\istailsort$,
    and $\leqs$ the order derived from $\ssection$, then for all $\xs : \MM(A)$,
    it holds that $\term{IsSorted}_{\leqs}(s(\xs))$.
    %
    Equivalently, for all lists $\xs : \LL(A)$,
    it holds that
    $\xs \in \im{s}$ iff $\term{IsSorted}_{\leqs}(\xs)$.
\end{proposition}
\begin{proof}
    We inspect the length of $\xs : \MM(A)$.
    For lengths 0 and 1, this holds trivially.
    Otherwise, we proceed by induction:
    given a $\xs : \MM(A)$ of length $\geq 2$, let $s(\xs) = x \cons y \cons \ys$.
    We need to show
    $x \leqs y \land \term{IsSorted}_{\leqs}(y \cons \ys)$ to construct
    $\term{IsSorted}_{\leqs}(x \cons y \cons \ys)$.
    By $\isheadleast$, we have $x \leqs y$, and by $\istailsort$, we
    inductively prove $\term{IsSorted}_{\leqs}(y \cons \ys)$.
\end{proof}

\begin{lemma}[\alink{lemma}{}]
    \label{sort:s2o2s}
    Given a decidable total order $\leq$ on $A$, we can construct
    a section $t_\leq$ satisfying $\isheadleast$ and $\istailsort$,
    such that, for the order $\leqs$ derived from $\ssection$,
    we have $t_{\leqs} = \ssection$.
\end{lemma}
\begin{proof}
    From $\ssection$ we can construct a decidable total order $\leqs$ since $\ssection$ satisfies
    $\isheadleast$ and $A$ has decidable equality by assumption.
    We construct $t_{\leqs}$ as insertion sort
    parameterized by $\leqs$ constructed from $\ssection$.
    By ~\cref{sort:sort-uniq} and ~\cref{sort:well-behave-sorts}, $s = t_{\leqs}$.
\end{proof}

\noindent
We can now state and prove our main theorem.
\begin{definition}[\alink{definition}{Sorting function}]
    \leavevmode
    A sorting function is a section $\ssection : \MM(A) \to \LL(A)$ to
    the canonical surjection $\quotient : \LL(A) \twoheadrightarrow \MM(A)$ satisfying two axioms:
    \begin{itemize}[leftmargin=*]
        \item $\isheadleast$:
              \(\,
              \inimage{x \cons \xs} \land y \in x \cons \xs \to \inimage{[x, y]}
              \),
        \item $\istailsort$:
              \(\,
              \inimage{x \cons \xs} \to \inimage{\xs}
              \).
    \end{itemize}
\end{definition}
\begin{theorem}[\alink{theorem}{}]
    \label{sort:main}
    Let $\term{DecTotOrd}(A)$ be the set of decidable total orders on $A$,
    $\term{Sort}(A)$ be the set of sorting functions with carrier set $A$,
    and $\term{Discrete}(A)$ be a predicate which states $A$ has decidable equality.
    There is a map $o2s \colon \term{DecTotOrd}(A) \to \term{Sort}(A) \times \term{Discrete}(A)$,
    which is an equivalence.
\end{theorem}
\begin{proof}
    $o2s$ is constructed by parameterizing insertion sort with $\leq$.
    By~\cref{prop:decidable-total-order}, $A$ is $\term{Discrete}$.
    %
    The inverse $s2o(s)$ is constructed by~\cref{def:least}, which produces
    a total order by~\cref{sort:almost-total,sort:trans},
    and a decidable total order by $\term{Discrete}(A)$.
    %
    By~\cref{sort:o2s2o} we have $s2o \comp o2s \id \idfunc$,
    and by~\cref{sort:s2o2s} we have $o2s \comp s2o \id \idfunc$,
    giving an isomorphism, hence an equivalence.
\end{proof}

\begin{corollary}[\alink{corollary}{}]
    \label{sort:linear-order}
    Let $\term{DecLinOrd}(A)$ be the set of decidable strict total orders on $A$,
    There is a map $l2s \colon \term{DecLinOrd}(A) \to \term{Sort}(A) \times \term{Discrete}(A)$,
    which is an equivalence.
\end{corollary}
\begin{proof}
    By~\cref{prop:decidable-total-order}, we have an equivalence
    $\term{DecLinOrd}(A) \simeq \term{DecTotOrd}(A)$, and the result follows from~\cref{sort:main}
    by equivalence transitivity.
\end{proof}
%
The sorting axioms we have come up with are abstract properties of functions.
%
As a sanity check, we can verify that the colloquial correctness specification of a sorting function (starting from a
total order) matches our axioms. We use the correctness criterion developed in~\cite{alexandruIntrinsicallyCorrectSorting2023}.
%
\begin{proposition}[\alink{proposition}{}]
    \label{prop:sort-correctness}
    Assume a decidable total order $\leq$ on $A$.
    %
    A sorting algorithm is a map $\term{sort} : {\LL(A) \to \OLL(A)}$,
    that turns lists into ordered lists,
    where $\OLL(A)$ is defined as $\dsum{\xs : \LL(A)}{\term{IsSorted}_{\leq}(\xs)}$,
    such that:
    % https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXExMKEEpIl0sWzIsMCwiXFxPTEwoQSkiXSxbMSwxLCJcXE1NKEEpIl0sWzAsMSwiXFx0ZXJte3NvcnR9Il0sWzAsMiwicSIsMl0sWzEsMiwicSBcXGNvbXAgXFxwaV8xIl1d
    \[\begin{tikzcd}
            {\LL(A)} && {\OLL(A)} \\
            & {\MM(A)}
            \arrow["{\term{sort}}", from=1-1, to=1-3]
            \arrow["q"', from=1-1, to=2-2]
            \arrow["{q \comp \pi_1}", from=1-3, to=2-2]
        \end{tikzcd}\]
    Sorting functions give sorting algorithms.
\end{proposition}
\begin{proof}
    We construct our section $\ssection:\MM(A) \to \LL(A)$,
    and define $\term{sort} \defeq \ssection \comp \quotient$,
    which produces ordered lists by~\cref{sort:well-behave-sorts}.
\end{proof}
